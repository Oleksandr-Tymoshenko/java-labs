<div th:fragment="productListFragment()" >
    <div id="product-grid" th:if="${products != null and !#lists.isEmpty(products)}"
         class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mx-20">
        <div th:each="product : ${products}">
            <div th:replace="~{fragments/product-card :: productCardFragment()}"
                 th:with="product=${product}"></div>
        </div>
    </div>
    <div th:if="${products == null or #lists.isEmpty(products)}" class="flex justify-center">
        <p>No products found</p>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const quantityInputs = document.querySelectorAll('.click-prevent-default');

            quantityInputs.forEach(input => {
                input.addEventListener('click', function (event) {
                    event.preventDefault();
                });
            });

            const addToCartButtons = document.querySelectorAll('.add-to-cart');

            addToCartButtons.forEach(button => {
                button.addEventListener('click', function (event) {
                    event.preventDefault();
                    const productId = this.getAttribute('data-id');
                    const quantity = document.getElementById(`quantity-${productId}`).value;
                    addToCart(productId, quantity);
                });
            });
        });

        function addToCart(productId, quantity) {
            fetch('/api/cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    productId: productId,
                    quantity: quantity
                })
            })
                .then(response => {
                    console.log(response)
                    if (response.redirected) {
                        window.location.href = response.url;
                    } else {
                        if (response.ok) {
                            alert('Added to cart');
                        } else {
                            alert('Couldn\'t add to cart');
                        }
                    }
                })
                .catch(error => console.error('Error:', error));
        }
    </script>
</div>